<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Content Manager</title>
    <meta http-equiv="Cache-Control" content="no-store" />
  </head>
  <body>
  <!-- Nhận token dạng #access_token=... hoặc #/access_token=... -->
  <script>
    (function () {
      var h = location.hash || "";
      if (h.startsWith("#/access_token=")) {
        location.replace("#access_token=" + h.slice("#/access_token=".length));
      }
      // Xóa mọi config/identity cũ của Netlify để không bị redirect tới api.netlify.com
      try {
        ["netlifySiteURL","netlifyAuth","netlify-cms-user","cms","decap-cms-app","decap-cms-user"]
          .forEach(k => localStorage.removeItem(k));
      } catch(e) {}
      // Ép cấu hình cho Decap ngay từ đầu (không đọc config.yml, không fallback Netlify)
      window.CMS_CONFIG = {
        load_config_file: false,
        backend: {
          name: "github",
          repo: "nguyen1357/NIO-Lab-Website",
          branch: "main",
          base_url: window.location.origin,
          auth_endpoint: "/api/auth"
        },
        site_domain: window.location.hostname,
        media_folder: "uploads",
        public_folder: "/uploads",
        collections: [
          {
            name: "posts",
            label: "Posts",
            folder: "content/posts",
            create: true,
            slug: "{{year}}-{{month}}-{{day}}-{{slug}}",
            fields: [
              { label: "Title", name: "title", widget: "string" },
              { label: "Date", name: "date", widget: "datetime" },
              { label: "Type", name: "type", widget: "select", options: ["News","Event","Update"] },
              { label: "Description", name: "description", widget: "text", required: false },
              { label: "External Link", name: "link", widget: "string", required: false },
              { label: "Body", name: "body", widget: "markdown" }
            ]
          }
        ]
      };
      // Không cần CMS.init – Decap tự đọc window.CMS_CONFIG
    })();
  </script>

  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
 </body>

</html>
